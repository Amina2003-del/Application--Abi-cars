<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr-FR">
   
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="description" content="gauto | Modèle HTML de Location de Voitures par Themescare">
      <meta name="keyword" content="taxi,voiture,location,transport">
      <meta name="author" content="Themescare">
      <!-- Titre -->
      <title>Carbnb</title>
      <!-- Favicon -->
             <link rel="stylesheet" th:href="@{/assets/css/bootstrap.css}">
<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/magnific-popup.css}">
<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/owl.theme.default.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/animate.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/jquery.datepicker.css}">
<link rel="stylesheet" th:href="@{/assets/css/nice-select.css}">
<link rel="stylesheet" th:href="@{/assets/css/lightgallery.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/jquery-clockpicker.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/slicknav.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/style.css}">
<link rel="stylesheet" th:href="@{/assets/css/responsive.css}">
<link rel="stylesheet" th:href="@{/assets/css/mettrelocation.css}">
<link rel="stylesheet" th:href="@{/assets/css/flatpickr.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/reservation.css}">

</head>
<body>

<div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
       
        <nav class="sidebar-menu">
            <a th:href="@{/Voitures/location}" ><i class="fa fa-car"></i> Mettre ma Location</a>
            <a th:href="@{/Voitures/avis}" ><i class="fa fa-star"></i> Consulter les Avis</a>
            <a th:href="@{/Voitures/reservation}" class="active"><i class="fa fa-calendar"></i> Réservations</a>
            <a th:href="@{/Voitures/message}"><i class="fa fa-gavel"></i> Litiges</a>
            <a th:href="@{/Voitures/login}"><i class="fa fa-sign-out"></i> Déconnexion</a>
        </nav>
    </aside>

    
 

    <div class="container mb-5">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">Gestion des Réservations</h3>
                <div class="d-flex">
                    <input type="text" id="searchInput" class="form-control search-box me-2" placeholder="Rechercher...">
                    <select id="statusFilter" class="form-select search-box">
                        <option value="all">Tous les statuts</option>
                        <option value="PENDING">En attente</option>
                        <option value="CONFIRMED">Confirmées</option>
                        <option value="CANCELLED">Annulées</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Voiture</th>
                                <th>Client</th>
                                <th>Dates</th>
                                <th>Prix total</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="reservation : ${reservations}">
                                <td th:text="${reservation.id}">123</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img th:src="${reservation.car.imageUrl}" alt="Voiture" class="rounded me-2" width="50">
                                        <div>
                                            <div th:text="${reservation.car.brand + ' ' + reservation.car.model}">Audi A4</div>
                                            <small class="text-muted" th:text="${reservation.car.type}">Berline</small>
                                        </div>
                                    </div>
                                </td>
                                <td th:text="${reservation.client.fullName}">Jean Dupont</td>
                                <td>
                                    <div th:text="${#temporals.format(reservation.startDate, 'dd/MM/yyyy') + ' - ' + #temporals.format(reservation.endDate, 'dd/MM/yyyy')}">
                                        15/06/2023 - 20/06/2023
                                    </div>
                                    <small class="text-muted" th:text="${reservation.days + ' jours'}">5 jours</small>
                                </td>
                                <td th:text="${#numbers.formatDecimal(reservation.totalPrice, 1, 2, 'POINT') + ' €'}">350.00 €</td>
                                <td>
                                    <span th:classappend="${reservation.status == 'PENDING' ? 'status-pending' : 
                                                         (reservation.status == 'CONFIRMED' ? 'status-confirmed' : 'status-cancelled')}"
                                          th:text="${reservation.status == 'PENDING' ? 'En attente' : 
                                                  (reservation.status == 'CONFIRMED' ? 'Confirmée' : 'Annulée')}">
                                        En attente
                                    </span>
                                </td>
                                <td>
                                    <div class="d-flex" th:if="${reservation.status == 'PENDING'}">
                                        <form th:action="@{/owner/reservations/{id}/confirm(id=${reservation.id})}" method="post" class="me-2">
                                            <button type="submit" class="btn btn-success btn-sm btn-action">
                                                <i class="bi bi-check-lg"></i> Confirmer
                                            </button>
                                        </form>
                                        <form th:action="@{/owner/reservations/{id}/cancel(id=${reservation.id})}" method="post">
                                            <button type="submit" class="btn btn-danger btn-sm btn-action">
                                                <i class="bi bi-x-lg"></i> Refuser
                                            </button>
                                        </form>
                                    </div>
                                    <span th:if="${reservation.status != 'PENDING'}" class="text-muted">Aucune action</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Page navigation" th:if="${totalPages > 1}">
                    <ul class="pagination justify-content-center mt-4">
                        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/owner/reservations(page=1)}">Premier</a>
                        </li>
                        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/owner/reservations(page=${currentPage-1})}">Précédent</a>
                        </li>
                        
                        <li class="page-item" th:each="page : ${#numbers.sequence(1, totalPages)}"
                            th:classappend="${currentPage == page} ? 'active'">
                            <a class="page-link" th:href="@{/owner/reservations(page=${page})}" th:text="${page}">1</a>
                        </li>
                        
                        <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                            <a class="page-link" th:href="@{/owner/reservations(page=${currentPage+1})}">Suivant</a>
                        </li>
                        <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                            <a class="page-link" th:href="@{/owner/reservations(page=${totalPages})}">Dernier</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>


</div>
 <!-- Bootstrap JS et dépendances -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:src="@{/assets/js/jquery.min.js}"></script>
    <script th:src="@{/assets/js/flatpickr.min.js}"></script> <!-- Flatpickr JS -->
    <script th:src="@{/assets/js/mettrelocation.js}"></script>
    <script th:src="@{/assets/js/mettrelocation.js}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        flatpickr("#dateLocation", {
            dateFormat: "Y",    // Choisir uniquement l'année
            minDate: "1900-01-01", // Date minimale
            maxDate: new Date().getFullYear(), // Date maximale (l'année en cours)
            altInput: true,      // Affichage alternatif (non-numérique)
            altFormat: "Y",      // Affichage de l'année
        });
    });
</script>

</body>
</html>

