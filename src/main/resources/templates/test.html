<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Propri√©taire - Gestion des R√©servations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
<link rel="stylesheet" th:href="@{/assets/css/entretiens.css}">
   
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen p-4 sm:p-6 font-sans antialiased">

    <header class="text-center mb-8">
    </header>

    <!-- Alerte de notification -->
<div class="alert max-w-3xl mx-auto bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-r-md mb-8" style="margin-top: 7rem;">
    <p class="text-sm">Votre <strong>Peugeot 208</strong> est en retard pour l‚Äôentretien des freins depuis le 28/07/2025. Veuillez planifier une intervention.</p>
</div>


    <!-- Section principale : Tableau des entretiens -->
<section class="max-w-5xl bg-white rounded-lg shadow-soft p-4 sm:p-6 mb-8" style="margin-left: 370px; margin-right: auto;">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6" >
            <h2 class="text-xl sm:text-2xl font-medium mb-4 sm:mb-0">Mes entretiens</h2>
            
            <!-- Bouton √©l√©gant pour ouvrir le modal -->
            <button id="openModalBtn" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 shadow-soft transition-elegant text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                Ajouter un entretien
            </button>
        </div>

        <!-- Filtres -->
        <div class="flex flex-col sm:flex-row gap-3 mb-6 border-t pt-4">
            <select class="w-full sm:w-auto p-2 text-sm border border-gray-300 rounded-md bg-white focus:border-blue-500">
                <option>Filtrer par statut</option>
                <option>√Ä jour</option>
                <option>√Ä faire bient√¥t</option>
                <option>En retard</option>
            </select>
            <select class="w-full sm:w-auto p-2 text-sm border border-gray-300 rounded-md bg-white focus:border-blue-500">
                <option>Filtrer par type</option>
                <option>Vidange</option>
                <option>Pneus</option>
                <option>Freins</option>
            </select>
            <select class="w-full sm:w-auto p-2 text-sm border border-gray-300 rounded-md bg-white focus:border-blue-500">
                <option>Filtrer par voiture</option>
                <option>Dacia Logan</option>
                <option>Peugeot 208</option>
                <option>Kia Picanto</option>
            </select>
        </div>

        <!-- Tableau -->
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="p-3 text-left font-medium">Voiture</th>
                        <th class="p-3 text-left font-medium">Type d'entretien</th>
                        <th class="p-3 text-left font-medium">Date pr√©vue</th>
                        <th class="p-3 text-left font-medium">Statut</th>
                        <th class="p-3 text-left font-medium">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition-elegant">
                        <td class="p-3 font-medium">Dacia Logan</td>
                        <td class="p-3">Vidange</td>
                        <td class="p-3">05/08/2025</td>
                        <td class="p-3 font-medium text-yellow-600">üü° √Ä faire</td>
                        <td class="p-3 flex gap-2">
                             <button class="p-2 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-elegant" title="Voir les d√©tails">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C3.732 4.943 7.522 3 10 3s6.268 1.943 9.542 7c-3.274 5.057-7.03 7-9.542 7S3.732 15.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
                            </button>
                            <button class="p-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-elegant" title="Modifier">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/></svg>
                            </button>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition-elegant">
                        <td class="p-3 font-medium">Peugeot 208</td>
                        <td class="p-3">Pneus</td>
                        <td class="p-3">15/09/2025</td>
                        <td class="p-3 font-medium text-green-600">üü¢ √Ä jour</td>
                        <td class="p-3">
                            <button class="p-2 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-elegant" title="Voir les d√©tails">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C3.732 4.943 7.522 3 10 3s6.268 1.943 9.542 7c-3.274 5.057-7.03 7-9.542 7S3.732 15.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
                            </button>
                        </td>
                    </tr>
                    <tr class="border-b border-gray-200 hover:bg-gray-50 transition-elegant">
                        <td class="p-3 font-medium">Kia Picanto</td>
                        <td class="p-3">Freins</td>
                        <td class="p-3">28/07/2025</td>
                        <td class="p-3 font-medium text-red-600">üî¥ En retard</td>
                        <td class="p-3">
                            <button class="p-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-elegant" title="Action urgente requise">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <div id="advancedModal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-3xl transform transition-all">
            <!-- Header -->
            <div class="flex justify-between items-center p-5 border-b">
                 <h3 class="text-xl font-semibold text-gray-900">Assistant d'ajout d'entretien</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-700 transition-colors rounded-full p-1">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>

            <!-- Barre de progression -->
            <div class="p-6">
                <div class="flex items-center">
                    <div id="step-indicator-1" class="progress-step flex-1 flex flex-col items-center border-b-4 pb-4 active">
                        <div class="step-circle w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500">1</div>
                        <div class="step-label text-sm mt-2 font-medium">Infos</div>
                    </div>
                    <div id="connector-1" class="progress-connector flex-auto border-t-2 h-0"></div>
                    <div id="step-indicator-2" class="progress-step flex-1 flex flex-col items-center border-b-4 pb-4 border-gray-200 text-gray-400">
                        <div class="step-circle w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold">2</div>
                        <div class="step-label text-sm mt-2 font-medium">D√©tails</div>
                    </div>
                    <div id="connector-2" class="progress-connector flex-auto border-t-2 h-0"></div>
                    <div id="step-indicator-3" class="progress-step flex-1 flex flex-col items-center border-b-4 pb-4 border-gray-200 text-gray-400">
                        <div class="step-circle w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold">3</div>
                        <div class="step-label text-sm mt-2 font-medium">Facture</div>
                    </div>
                    <div id="connector-3" class="progress-connector flex-auto border-t-2 h-0"></div>
                    <div id="step-indicator-4" class="progress-step flex-1 flex flex-col items-center border-b-4 pb-4 border-gray-200 text-gray-400">
                        <div class="step-circle w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold">4</div>
                        <div class="step-label text-sm mt-2 font-medium">R√©sum√©</div>
                    </div>
                </div>
            </div>

            <!-- Conteneur des √©tapes du formulaire -->
            <div class="p-6 pt-0">
                <form id="multi-step-form">
                    <!-- √âtape 1: Infos g√©n√©rales -->
                    <div class="form-step active" data-step="1">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Informations g√©n√©rales</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label for="car" class="block text-sm font-medium text-gray-700">Voiture concern√©e</label>
                                <select id="car" name="car" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg shadow-sm" required>
                                    <option value="">-- S√©lectionner --</option>
                                    <option>Dacia Logan</option>
                                    <option>Peugeot 208</option>
                                </select>
                            </div>
                            <div>
                                <label for="type" class="block text-sm font-medium text-gray-700">Type d‚Äôentretien</label>
                                <select id="type" name="type" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg shadow-sm" required>
                                     <option value="">-- S√©lectionner --</option>
                                    <option>Vidange</option>
                                    <option>Pneus</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- √âtape 2: D√©tails et co√ªts -->
                    <div class="form-step" data-step="2">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">D√©tails et Co√ªts</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label for="date" class="block text-sm font-medium text-gray-700">Date de r√©alisation</  label>
                                <input type="date" id="date" name="date" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg shadow-sm" required>
                            </div>
                             <div>
                                <label for="cost" class="block text-sm font-medium text-gray-700">Co√ªt (‚Ç¨)</label>
                                <input type="number" id="cost" name="cost" step="0.01" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg shadow-sm" placeholder="Ex: 150.50" required>
                            </div>
                            <div class="sm:col-span-2">
                                <label for="remarks" class="block text-sm font-medium text-gray-700">Remarques / Garage</label>
                                <textarea id="remarks" name="remarks" rows="3" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg shadow-sm" placeholder="Ajouter des d√©tails..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- √âtape 3: Facture -->
                    <div class="form-step" data-step="3">
                         <h4 class="text-lg font-semibold mb-4 text-gray-800">Documentation</h4>
                         <label id="invoice-dropzone" class="mt-1 flex flex-col items-center justify-center w-full h-48 px-4 transition bg-gray-50 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:border-blue-500">
                             <div id="upload-prompt" class="flex flex-col items-center text-gray-500">
                                <svg class="w-12 h-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                <span class="font-medium mt-2">Cliquer ou glisser un fichier</span>
                                <span class="text-xs mt-1">PDF, PNG, JPG (MAX. 5MB)</span>
                             </div>
                             <div id="file-preview" class="hidden items-center gap-4 text-gray-700">
                                <svg class="w-12 h-12 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                                <div>
                                    <p id="file-name" class="font-medium"></p>
                                    <p id="file-size" class="text-sm"></p>
                                </div>
                                <button type="button" id="remove-file" class="ml-auto text-red-500 hover:text-red-700">√ó</button>
                             </div>
                         </label>
                         <input type="file" id="invoice-input" name="invoice" class="hidden">
                    </div>

                     <!-- √âtape 4: R√©sum√© -->
                    <div class="form-step" data-step="4">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Veuillez v√©rifier les informations</h4>
                        <div id="summary-content" class="space-y-3 text-sm"></div>
                    </div>
                </form>
            </div>
            
            <!-- Footer avec boutons de navigation -->
            <div class="flex justify-between items-center gap-4 p-5 bg-gray-50 rounded-b-xl border-t mt-2">
                <button type="button" id="prevBtn" class="px-5 py-2.5 bg-white text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-all font-semibold invisible">Pr√©c√©dent</button>
                <button type="button" id="nextBtn" class="px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-semibold shadow ml-auto">Suivant</button>
                <button type="submit" id="submitBtn" form="multi-step-form" class="hidden px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all font-semibold shadow">Soumettre l'entretien</button>
            </div>
        </div>
    </div>

    <nav class="navbar-custom-tailwind">
        <div class="navbar-left">
            <button id="mobileSidebarToggle" class="text-white focus:outline-none md:hidden me-3">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <span class="brand">Rent Car</span>
        </div>
        <div class="navbar-center">
            <div class="search-bar-navbar">
                <i class="fas fa-search"></i>
                <input type="text" id="navbarSearchInput" placeholder="Rechercher une r√©servation..." oninput="searchReservations()">
            </div>
        </div>
        <div class="navbar-right">
            <div class="nav-icon-btn" id="alertsIconCustom">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
            </div>
            <div class="nav-icon-btn" id="languageSwitchCustom">
                <span class="flag-icon flag-icon-fr"></span>
            </div>
            <div class="user-profile" id="userProfileCustom">
                <i class="fas fa-user-circle"></i>
                <span th:text="${currentUser != null ? currentUser.getDisplayName() : 'Invit√©'}"></span>
                <i class="fas fa-chevron-down fa-xs"></i>
            </div>
           <div class="dropdown-menu-custom" id="userDropdownCustom">
                <a href="#" id="showUserProfile" data-bs-toggle="modal" data-bs-target="#userModal">
                <i class="fas fa-user-edit"></i>Mon profil</a>
<a th:href="@{/logout}" >
  <i class="fas fa-sign-out-alt"></i>Se d√©connecter
</a>
            </div>
        </div>
    </nav>
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      
      <div class="modal-header bg-primary text-white rounded-top">
        <h5 class="modal-title" id="userModalLabel">Profil Utilisateur</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body user-info">
        <form id="userProfileForm">
          <div class="row g-3">

            <div class="col-md-6">
              <label for="firstName" class="form-label">Pr√©nom</label>
              <input type="text" class="form-control" id="firstName" name="firstName">
            </div>

            <div class="col-md-6">
              <label for="lastName" class="form-label">Nom</label>
              <input type="text" class="form-control" id="lastName" name="lastName">
            </div>

            <div class="col-md-6">
              <label for="phone" class="form-label">T√©l√©phone</label>
              <input type="tel" class="form-control" id="phone" name="phone">
            </div>

            <div class="col-md-6">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email">
            </div>

            <div class="col-12 position-relative">
              <label for="password" class="form-label">Nouveau mot de passe</label>
              <input type="password" class="form-control pe-5" id="password" name="password">
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
            </div>

          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-primary" id="saveProfile">Enregistrer</button>
      </div>

    </div>
  </div>
</div>
    <div class="modal-custom-non-bootstrap" id="alertsModalCustom">
        <div class="modal-header-custom-non-bootstrap">
            <h3>Alertes r√©centes</h3>
            <span class="close-btn" id="closeAlertsModalCustom">√ó</span>
        </div>
        <div class="modal-body-custom-non-bootstrap">
            <div class="alert-item">
                <div class="alert-content">
                    <div class="alert-title">Maintenance voiture #123</div>
                    <div class="alert-message">V√©rification des freins requise.</div>
                </div>
                <div class="alert-meta">
                    <div class="alert-time">Il y a 15 min</div>
                    <span class="alert-status status-urgent">Urgent</span>
                </div>
            </div>
            <div class="alert-item">
                <div class="alert-content">
                    <div class="alert-title">R√©servation en attente</div>
                    <div class="alert-message">Confirmer la r√©servation de M. Durand.</div>
                </div>
                <div class="alert-meta">
                    <div class="alert-time">Il y a 2 heures</div>
                    <span class="alert-status status-waiting">En attente</span>
                </div>
            </div>
        </div>
    </div>
    <aside id="sidebarCustom" class="sidebar-custom-tailwind sidebar-expanded">
        <div class="sidebar-header">
            <div class="brand-logo-wrapper">
                <i class="fas fa-car-alt brand-icon"></i>
                <span class="brand-text" id="sidebarBrandText">Rent Car</span>
            </div>
            <button id="toggleSidebarCustom" class="toggle-btn">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <nav class="sidebar-menu">
            <a href="/Owner/dashboard" class="sidebar-item">
                <i class="fas fa-tachometer-alt menu-icon text-blue-400"></i>
                <span class="sidebar-text">Tableau de Bord</span>
            </a>
            <a href="/Owner/message" class="sidebar-item">
                <i class="fas fa-envelope menu-icon text-sky-400"></i>
                <span class="sidebar-text">Messages</span>
            </a>
            <a href="/Owner/clientespace" class="sidebar-item">
                <i class="fas fa-users menu-icon text-fuchsia-400"></i>
                <span class="sidebar-text">Clients</span>
            </a>
            <a href="/Owner/litige" class="sidebar-item">
                <i class="fas fa-gavel menu-icon text-rose-500"></i>
                <span class="sidebar-text">Litiges</span>
            </a>
            <a href="/Owner/voitures" class="sidebar-item">
                <i class="fas fa-car-side menu-icon text-emerald-500"></i>
                <span class="sidebar-text">Voitures</span>
            </a>
            <a href="/Owner/reservation" class="sidebar-item active">
                <i class="fas fa-calendar-check menu-icon text-amber-500"></i>
                <span class="sidebar-text">R√©servations</span>
            </a>
            <a href="/Owner/notifications" class="sidebar-item">
                <i class="fas fa-bell menu-icon text-violet-500"></i>
                <span class="sidebar-text">Notifications</span>
            </a>
              <a href="/Owner/entretiens" class="sidebar-item">
    <i class="fas fa-wrench menu-icon text-orange-400"></i>
    <span class="sidebar-text">Entretiens</span>
</a>
            <a href="/Owner/paiement" class="sidebar-item">
                <i class="fas fa-credit-card menu-icon text-cyan-500"></i>
                <span class="sidebar-text">Paiement</span>
            </a>
        </nav>
    </aside>
   
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
      <script>
$(document).ready(function() {
    // Charger les donn√©es de l'utilisateur
    $('#showUserProfile').click(function(e) {
        e.preventDefault();
        $.ajax({
            url: '/api/user/profille',
            type: 'GET',
            success: function(user) {
                $('#firstName').val(user.firstName);
                $('#lastName').val(user.lastName);
                $('#phone').val(user.phone);
                $('#email').val(user.email);
                $('#password').val(''); // Champ mot de passe vide par d√©faut
            },
            error: function(xhr) {
                alert('Erreur lors de la r√©cup√©ration des informations: ' + xhr.responseText);
            }
        });
    });

    // Basculer l'affichage du mot de passe
    $('#togglePassword').click(function() {
        const passwordField = $('#password');
        const type = passwordField.attr('type') === 'password' ? 'text' : 'password';
        passwordField.attr('type', type);
        $(this).toggleClass('fa-eye fa-eye-slash');
    });

    // Enregistrer les modifications
    $('#saveProfile').click(function() {
        const userData = {
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            phone: $('#phone').val(),
            email: $('#email').val(),
            password: $('#password').val()
        };

        $.ajax({
            url: '/api/user/proprofile',
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(userData),
            success: function(response) {
                alert('Profil mis √† jour avec succ√®s !');
                $('#userModal').modal('hide');
            },
            error: function(xhr) {
                alert('Erreur lors de la mise √† jour du profil: ' + xhr.responseText);
            }
        });
    });
});
</script>
  <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- GESTION DU MODAL AVANC√â ---
            const modal = document.getElementById('advancedModal');
            const openModalBtn = document.getElementById('openModalBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            const formSteps = document.querySelectorAll('.form-step');
            
            let currentStep = 1;
            const formData = {};

            // Ouvre et ferme le modal
            openModalBtn.addEventListener('click', () => modal.classList.remove('hidden', 'opacity-0'));
            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden', 'opacity-0'));

            // Navigation
            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    saveStepData(currentStep);
                    if (currentStep < formSteps.length) {
                        currentStep++;
                        updateFormSteps();
                        updateProgress();
                    }
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateFormSteps();
                    updateProgress();
                }
            });

            function updateFormSteps() {
                formSteps.forEach(step => step.classList.toggle('active', parseInt(step.dataset.step) === currentStep));
                if(currentStep === 4) generateSummary();
            }

            function updateProgress() {
                // Barre de progression
                for (let i = 1; i <= formSteps.length; i++) {
                    const step = document.getElementById(`step-indicator-${i}`);
                    const connector = document.getElementById(`connector-${i-1}`);
                    step.classList.toggle('active', i === currentStep);
                    step.classList.toggle('completed', i < currentStep);
                    if (connector) connector.classList.toggle('completed', i <= currentStep);
                }
                
                // Boutons
                prevBtn.classList.toggle('invisible', currentStep === 1);
                nextBtn.classList.toggle('hidden', currentStep === formSteps.length);
                submitBtn.classList.toggle('hidden', currentStep !== formSteps.length);
            }

            function validateStep(step) {
                const currentFormStep = document.querySelector(`.form-step[data-step="${step}"]`);
                const inputs = currentFormStep.querySelectorAll('input[required], select[required]');
                let isValid = true;
                
                inputs.forEach(input => {
                    input.classList.remove('input-error');
                    if (!input.value) {
                        isValid = false;
                        input.classList.add('input-error');
                    }
                });
                return isValid;
            }
            
            function saveStepData(step) {
                const currentFormStep = document.querySelector(`.form-step[data-step="${step}"]`);
                const inputs = currentFormStep.querySelectorAll('input, select, textarea');
                inputs.forEach(input => formData[input.name] = input.value);
            }

            function generateSummary() {
                const summaryContent = document.getElementById('summary-content');
                summaryContent.innerHTML = `
                    <div class="flex justify-between py-2 border-b"><span class="font-medium text-gray-500">Voiture :</span> <span class="font-semibold">${formData.car || 'N/A'}</span></div>
                    <div class="flex justify-between py-2 border-b"><span class="font-medium text-gray-500">Type :</span> <span class="font-semibold">${formData.type || 'N/A'}</span></div>
                    <div class="flex justify-between py-2 border-b"><span class="font-medium text-gray-500">Date :</span> <span class="font-semibold">${formData.date || 'N/A'}</span></div>
                    <div class="flex justify-between py-2 border-b"><span class="font-medium text-gray-500">Co√ªt :</span> <span class="font-semibold">${formData.cost ? formData.cost + ' ‚Ç¨' : 'N/A'}</span></div>
                    <div class="flex justify-between py-2 border-b"><span class="font-medium text-gray-500">Remarques :</span> <span class="font-semibold text-right">${formData.remarks || 'Aucune'}</span></div>
                    <div class="flex justify-between py-2"><span class="font-medium text-gray-500">Facture :</span> <span class="font-semibold">${formData.invoice ? 'Fichier joint' : 'Aucun fichier'}</span></div>
                `;
            }

            // Gestion du fichier
            const dropzone = document.getElementById('invoice-dropzone');
            const fileInput = document.getElementById('invoice-input');
            const uploadPrompt = document.getElementById('upload-prompt');
            const filePreview = document.getElementById('file-preview');

            dropzone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFile);

            function handleFile() {
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    formData.invoice = file.name;
                    document.getElementById('file-name').textContent = file.name;
                    document.getElementById('file-size').textContent = `${(file.size / 1024).toFixed(1)} KB`;
                    uploadPrompt.classList.add('hidden');
                    filePreview.classList.remove('hidden');
                    filePreview.classList.add('flex');
                }
            }
            
            document.getElementById('remove-file').addEventListener('click', (e) => {
                e.stopPropagation();
                fileInput.value = '';
                formData.invoice = '';
                uploadPrompt.classList.remove('hidden');
                filePreview.classList.add('hidden');
            });

        })
            // --- GESTION DU GRAPHIQUE ---
         

    </script>
</body>
</html>